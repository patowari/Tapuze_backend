# Postman API Testing Guide

This guide provides instructions and examples for testing the backend API of the AI Math Grader application using [Postman](https://www.postman.com/).

## Setup in Postman

1.  **Start the Backend Server**: Before you begin, make sure the Node.js server is running with the correct `.env` file and all native dependencies installed.
    ```bash
    cd server
    npm start
    ```
    The server will be running at `http://localhost:3001`.

2.  **Create an Environment (Optional but Recommended)**: In Postman, create a new environment and add a variable:
    - **Variable**: `baseURL`
    - **Initial Value**: `http://localhost:3001/api`

3.  **Set Headers**: For most `POST` and `PUT` requests, you'll need to set the `Content-Type` header to `application/json`. This is not needed for file uploads.

---

## API Endpoints

Here are the details for each endpoint.

### 1. Get All Classrooms

- **Method**: `GET`
- **URL**: `{{baseURL}}/classrooms`

### 2. Create a New Classroom (Teacher)

- **Method**: `POST`
- **URL**: `{{baseURL}}/classrooms`
- **Headers**: `Content-Type: application/json`
- **Body**: `raw` (JSON)
  ```json
  {
    "name": "Algebra 1 - Fall Semester"
  }
  ```

### 3. Join a Classroom (Student)

- **Method**: `POST`
- **URL**: `{{baseURL}}/classrooms/join`
- **Headers**: `Content-Type: application/json`
- **Body**: `raw` (JSON)
  ```json
  {
    "secretCode": "YOUR_SECRET_CODE",
    "studentId": "student-01"
  }
  ```

### 4. Create a New Assignment (Teacher)

- **Method**: `POST`
- **URL**: `{{baseURL}}/classrooms/:classroomId/assignments`
- **Headers**: `Content-Type: application/json`
- **Body**: `raw` (JSON)
  ```json
  {
    "title": "Chapter 5 Homework - Polynomials"
  }
  ```

### 5. Test PDF Conversion (Developer Debugging)

This endpoint allows you to upload a PDF and get the resulting base64-encoded image string back. This is extremely useful for **debugging the server-side PDF conversion process** separately from the AI evaluation. You can take the returned `fileData` string and use an online viewer to ensure your PDF was converted correctly.

- **Method**: `POST`
- **URL**: `{{baseURL}}/test-pdf-conversion`
- **Body**: `form-data`
  1.  Key: `homeworkPdf`
  2.  Change the type from "Text" to **"File"**.
  3.  Value: Select a PDF file from your computer.
- **Headers**: Postman will set the `multipart/form-data` headers automatically.
- **Response**: A JSON object containing the original filename and the base64 image data.
  ```json
  {
    "fileName": "your_homework.pdf",
    "fileData": "iVBORw0KGgoAAAANSUhEUgAAB..."
  }
  ```

### 6. Test AI Evaluation with PDF Upload (Developer)

Sends a **PDF file** directly to the backend for processing and evaluation. This is ideal for testing the full server-side flow.

- **Method**: `POST`
- **URL**: `{{baseURL}}/test-evaluation`
- **Body**: `form-data`
  1.  In the row for the key, type `homeworkPdf`.
  2.  On the right side of the key field, click the dropdown that says "Text" and change it to **"File"**.
  3.  A "Select Files" button will appear in the value column. Click it and choose a PDF file from your computer.
- **Headers**: Do **not** set a `Content-Type` header manually. Postman will automatically handle the `multipart/form-data` headers when you use the `form-data` body type.
- **Response**: A complete `GradingResponse` JSON object, as generated by the AI.

### 7. Test AI Evaluation with Base64 Image (Frontend Simulation)

Sends a base64-encoded **image** directly to the backend for evaluation. This simulates the request made by the frontend application.

- **Method**: `POST`
- **URL**: `{{baseURL}}/evaluate`
- **Headers**: `Content-Type: application/json`
- **Body**: `raw` (JSON)
  ```json
  {
    "fileData": "iVBORw0KGgoAAAANSUhEUgAAAAUA..."
  }
  ```
  > **Important**: The `fileData` must be a base64 encoded string representing an **image**. You can use an online converter (like [base64-image.de](https://www.base64-image.de/)) to convert a sample homework image into a string for testing.

### 8. Submit Homework (Frontend Simulation)

Creates or updates a submission for a specific assignment using a base64 image, mimicking the frontend.

- **Method**: `POST`
- **URL**: `{{baseURL}}/classrooms/:classroomId/assignments/:assignmentId/submissions`
- **Headers**: `Content-Type: application/json`
- **Body**: `raw` (JSON)
  ```json
  {
    "studentId": "student-01",
    "fileName": "my_homework.pdf",
    "fileData": "iVBORw0KGgoAAAANSUhEUgAAAAUA..."
  }
  ```

### 9. Grade a Submission (Teacher)

Adds or updates the evaluation for a student's submission. This marks the assignment as graded. You would typically use the JSON object you received from the `/api/test-evaluation` or `/api/evaluate` endpoint here.

- **Method**: `PUT`
- **URL**: `{{baseURL}}/classrooms/:classroomId/assignments/:assignmentId/submissions/:submissionId`
- **Headers**: `Content-Type: application/json`
- **Body**: `raw` (JSON).
  ```json
  {
    "evaluation": {
      "overall_score": 88,
      "problem_breakdown": [
        {
          "problem_description": {
            "en": "Question 1: Solving a quadratic equation",
            "he": "שאלה 1: פתרון משוואה ריבועית"
          },
          "score": 22,
          "max_score": 25,
          "feedback": {
            "en": "Good effort. You correctly identified the formula, but made a small calculation error.",
            "he": "מאמץ טוב. זיהית נכון את הנוסחה, אך עשית טעות חישוב קטנה."
          },
          "teacher_recommendation": {
            "en": "The student understands the quadratic formula but needs to be more careful with arithmetic.",
            "he": "התלמיד מבין את נוסחת השורשים אך צריך להיזהר יותר בחשבון."
          },
          "errors": [
            {
              "error_type": "minor_slip",
              "deduction": 3,
              "explanation": {
                "en": "The student incorrectly calculated 4 * 2 * 3 as 22 instead of 24 inside the square root.",
                "he": "התלמיד חישב באופן שגוי 4 * 2 * 3 כ-22 במקום 24 בתוך השורש הריבועי."
              },
              "hint": {
                "en": "Always double-check your arithmetic, especially when working with multiple terms under a square root.",
                "he": "בדוק תמיד את החשבון שלך, במיוחד כשעובדים עם מספר איברים מתחת לשורש ריבועי."
              },
              "boundingBox": { "x": 0.45, "y": 0.3, "width": 0.15, "height": 0.1 }
            }
          ]
        }
      ]
    }
  }
  ```